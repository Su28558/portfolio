<script>
// Gradient-Themes: passe hier die Stimmungen an
const THEMES = {
  dawn:  { c1:"#cfe6ff", c2:"#ffffff", c3:"#e9f0ff",  dark:false }, // bläulich > weiß
  paper: { c1:"#ffffff", c2:"#ffffff", c3:"#ffffff",  dark:false }, // komplett hell
  dusk:  { c1:"#97a7ff", c2:"#ebedff", c3:"#0f1422",  dark:false }, // milder Übergang Richtung dunkel
  night: { c1:"#232738", c2:"#111319", c3:"#07090f",  dark:true  }  // dunkler Bereich
};

(function(){
  const bg = document.querySelector('.bgfx');
  const sections = [...document.querySelectorAll('section[data-theme], .marquee-wrap[data-theme]')];

  // IntersectionObserver – aktiver Abschnitt bestimmt Farben
  const io = new IntersectionObserver((entries)=>{
    // wähle den Eintrag mit der größten Sichtbarkeit
    let best = null;
    entries.forEach(e=>{
      if(!best || e.intersectionRatio > best.intersectionRatio){ best = e; }
    });
    if(!best) return;
    const themeName = best.target.getAttribute('data-theme') || 'paper';
    const t = THEMES[themeName] || THEMES.paper;

    // sanfte Umschaltung der Gradient-Farben via neue Background-Zusammensetzung
    bg.style.setProperty('--cx', '50%');
    bg.style.setProperty('--cy', '40%');
    // Neuer Hintergrund mit t.c1/c2/c3 (wir setzen direkt als CSS-String, damit die Transition greift)
    bg.style.background = `
      radial-gradient(1200px 800px at var(--cx) var(--cy),
        color-mix(in oklab, ${t.c1} 92%, transparent) 0%,
        color-mix(in oklab, ${t.c2} 85%, transparent) 55%,
        color-mix(in oklab, ${t.c3} 90%, transparent) 100%),
      radial-gradient(800px 600px at calc(var(--cx) + 20%) calc(var(--cy) + 15%),
        color-mix(in oklab, ${t.c1} 22%, transparent) 0%,
        transparent 70%),
      linear-gradient(180deg,
        color-mix(in oklab, ${t.c1} 20%, ${t.c2}) 0%,
        ${t.c2} 60%,
        color-mix(in oklab, ${t.c3} 40%, ${t.c2}) 100%)`;

    document.body.classList.toggle('theme-dark', !!t.dark);
    document.body.classList.toggle('theme-light', !t.dark);
  }, { threshold:[0, .25, .5, .75, 1] });

  sections.forEach(s=>io.observe(s));

  // Parallax/Pointer – BG-Zentrum bewegt sich leicht (dezent, performance-schonend)
  let raf = null, cx = 50, cy = 40, targetCx = 50, targetCy = 40;
  function animate(){
    cx += (targetCx - cx) * 0.08;
    cy += (targetCy - cy) * 0.08;
    document.querySelector('.bgfx').style.setProperty('--cx', cx+'%');
    document.querySelector('.bgfx').style.setProperty('--cy', cy+'%');
    raf = null;
  }
  function onPointer(x, y){
    const ww = window.innerWidth, wh = window.innerHeight;
    targetCx = 35 + (x/ww)*30;  // 35%..65%
    targetCy = 30 + (y/wh)*30;  // 30%..60%
    if(!raf) raf = requestAnimationFrame(animate);
  }
  window.addEventListener('mousemove', (e)=> onPointer(e.clientX, e.clientY), {passive:true});
  window.addEventListener('touchmove', (e)=>{
    const t = e.touches[0]; if(t) onPointer(t.clientX, t.clientY);
  }, {passive:true});
})();
</script>
